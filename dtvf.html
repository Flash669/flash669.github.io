
<html lang="es"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style type="text/css">
    body {
      margin: 0;
      padding: 0;
    }
  </style>
  <title>Gustavo Cerati</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script src="https://content.jwplatform.com/libraries/KB5zFt7A.js"></script>
</head>
<body>
  <div id="player"></div>

 <script>
    let token = "tu_token_aqui";

    // Obtener el valor del parámetro 'id' de la URL utilizando la función getParameterByName
    var channelId = getParameterByName('id');

    // Definir información para diferentes canales
    let channelInfo = {
        "canal1": {
            chid: "CH0100000000341",
            keyId: "de7d7ded48b437d691966acdc8a97262",
            key: "c1696c67cf7a678932d33340135ea82b"
        },
        "canal2": {
            chid: "CH0200000001234",
            keyId: "aabbccddeeff11223344556677889900",
            key: "00112233445566778899001122334455"
        },
        // Agrega más canales según sea necesario
    };

    // Obtener la información del canal actual
    let currentChannel = channelInfo[channelId];

    // Verificar si se encontró información para el canal actual
    if (currentChannel) {
        fetchAuthorizationToken(token, currentChannel);
    } else {
        console.error("No se encontró información para el canal especificado en la URL.");
    }

    function fetchAuthorizationToken(token, channel) {
        fetch("https://api.directvgo.com/entitlement/v3/playback/token/authorizer", {
            method: "POST",
            headers: {
                "Authorization": "Bearer " + token,
                "Content-Type": "application/json",
                "X-Client-Id": "web",
                "X-Client-Version": "3.17.0"
            },
            body: JSON.stringify({
                contentId: channel.chid,
                delay: 0,
                isLive: true,
                mobileNetwork: true
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.manifest && data.manifest.dash && data.manifest.dash.primary) { 
          let manifestUrl = data.manifest.dash.primary; 

          // Realizar solicitud para obtener hdntl 
          fetch(manifestUrl) 
            .then(response => { 
              if (!response.ok) { 
                throw new Error('HTTP error! status: ' + response.status); 
              } 
              const hdntl = response.headers.get('hdntl'); 
              if (hdntl) { 
                // hdntl está disponible, puedes usarlo según sea necesario 
                console.log('hdntl:', hdntl); 

                // Configurar JWPlayer con clearkey y hdntl 
                let player = jwplayer("player"); 
                player.setup({ 
                  playlist: [{ 
                    sources: [{ 
                      default: false, 
                      type: "dash", 
                      file: manifestUrl, 
                      drm: { 
                        clearkey: { 
                          keyId: keyId, 
                          key: key 
                        } 
                      }, 
                      label: "0", 
                      // Agregar encabezado "Hdntl" a la solicitud de audio 
                      onXhrOpen: function (xhr, url) { 
                        if (!url.includes("manifest.mpd")) { 
                          xhr.setRequestHeader("Hdntl", hdntl); 
                        } 
                      } 
                    }] 
                  }], 
                  width: "100%", 
                  height: "100%", 
                  aspectratio: "16:9", 
                  autostart: true, 
                  cast: {}, 
                  sharing: false 
                }); 
              } else { 
                console.log('Header "hdntl" not found in the response.'); 
              } 
              return response.text(); 
            }) 
            .catch(error => console.error('Error fetching MPD:', error)); 

        } else { 
          console.error("Dash primary URL not found in the response."); 
        } 
        })
        .catch(error => console.error("Error fetching authorization token:", error));
    }

    // Función getParameterByName
    function getParameterByName(name) {
        name = name.replace(/[\[]/, "\[").replace(/[\]]/, "\]");
        var regex = new RegExp("[\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }
</script>



 
</body></html>
