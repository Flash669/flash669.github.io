<!DOCTYPE html>
<html lang="es">
<head>
  <style type="text/css">
    body {
       margin: 0;
       padding: 0;
    }
  </style>
  <meta name='referrer' content='no-referrer' />
  <meta name="robots" content="noindex">
  <style type="text/css">.jw-icon.jw-icon-inline.jw-button-color.jw-reset.jw-playlist-btn {display: none;}</style>
  <script src="//ssl.p.jwpcdn.com/player/v/8.21.2/jwplayer.js"></script>
  <script>
    jwplayer.key = 'XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo';
  </script>
  
</head>
<body>
<div id="player"></div>
  <script>
    function getParameterByName(name) {
      name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
      var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
          results = regex.exec(location.search);
      return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

    var getURL  = getParameterByName('get');
    var getIMG  = getParameterByName('img');
    var getLang = getParameterByName('lang');

    if (getURL == "#") {alert('Vuelve a la página anterior');}
    if (getIMG == "#") {alert('Vuelve a la página anterior');}

    const url = "https://live-media-aka.warnermediacdn.com/cmaf/live/2028104/37883-cenc/master_wv_de.m3u8";
    const headers = {
      "akamai-mon-iucid-del": "1291860",
      "akamai-mon-iucid-ing": "2028104",
      "akamai-request-bc": "[a=179.40.131.191,b=805785715,c=g,n=AR__BUENOSAIRES,o=22927],[c=p,n=AR__BUENOSAIRES,o=22927],[c=c,n=AR__BUENOSAIRES,o=20940],[a=23.63.242.65,c=o]",
      "cache-control": "max-age=0, no-cache, no-store",
      "content-type": "application/x-mpegURL",  // Cambiado a 'application/x-mpegURL'
    };

    fetch(url, { method: "GET", headers: headers })
      .then(response => response.text()) // Cambiado a response.text()
      .then(data => {
        // Manipula el manifiesto M3U8 según tus necesidades
        console.log("Master manifest response:", data);

        // Aquí deberías analizar el manifiesto M3U8 y extraer la información relevante
        // Para simplificar, asumiremos que hay una línea que comienza con '#EXT-X-STREAM-INF'
        // que contiene la URL del archivo HLS
        const lines = data.split('\n');
        let hlsUrl;
        for (const line of lines) {
          if (line.startsWith('#EXT-X-STREAM-INF')) {
            // Extraer la URL del archivo HLS (ajusta según la estructura de tu manifiesto)
            hlsUrl = lines[lines.indexOf(line) + 1];
            break;
          }
        }

        // Configura el reproductor JWPlayer con la URL del archivo HLS
        var playerInstance = jwplayer("player");
        playerInstance.setup({
          file: hlsUrl,
          image: getIMG, // No es necesario usar atob aquí
          type: "hls",
          width: "100%",
          height: "100%",
          aspectratio: "16:9",
          autostart: false,
          cast: {},
        });

        // Configura la pista de audio actual al reproducir el video
        if (getLang == "") {
          lang = 1;
        }
        jwplayer().on('play', function (e) {
          jwplayer().setCurrentAudioTrack(lang);
        });
      })
      .catch(error => console.error("Error:", error));
  </script>
</body>
</html>
