<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor Directv GO</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <script src="https://content.jwplatform.com/libraries/KB5zFt7A.js"></script>
    <script data-cfasync="false" src="//achcdn.com/script/suv4.js" data-adel="lwsu" cdnd="achcdn.com" zid="7692102"></script>
</head>

<body>
    <div id="player"></div>

    <script>
        // Token de autorización
        let token = "eyJhbGciOiJSUzI1NiJ9.eyJ1dWlkIjoiM2NkZjI0NDQtODBkYS00MzYwLWFkOTgtY2Y1NWM5NThhZDVmIiwiYXRfaGFzaCI6IjJ0QW5ZcHRFLV96MS83V3JFY0ZNWVEiLCJhdWRpdFRyYWNraW5nSWQiOiJkNDI0LWIxZWItNDA0Mi05YWNkLWNhZDgiLCJ0b2tlbk5hbWUiOiJpZF90b2tlbiIsImF1ZCI6ImR0dmdvIiwiYXpwIjoiZHR2Z28iLCJhdXRoX3RpbWUiOjE3MDI0MjYyODkwODUsInRva2VuVHlwZSI6IkpXVFRva2VuIiwiZW1haWwiOiJjb3JvbmVsczU1OEBnbWFpbC5jb20iLCJwaG9uZU51bWJlciI6IjAwMDAwMDAwMDAwIiwiY3VzdG9tZXJTdGF0dXMiOiJBY3RpdmUiLCJhY2NvdW50SWQiOiIxYmQzODQyMi00OGI4LTUwOGMtOGZiMS05ZGRmNGZmZDI1NDkiLCJmYW1pbHlOYW1lIjoiQ09ST05FTCIsImlzbzJDb2RlIjoiTVgiLCJnaXZlbk5hbWUiOiJqRVNVUyIsImRldmljZUlkIjoiZGZjNDViNTM4OWEyNmQ2YzgzNWY5Zjg3NWE5MmFiNDgwODkwZWQ0YyIsImNsaWVudElQIjoiMTgxLjIwOS43NS4xNTYiLCJtc29OYW1lIjoiZHR2IiwiY2hhbm5lbHMiOlsiQ0gwMTAwMDAwMDAwMzE1IiwiQ0gwMTAwMDAwMDAwMzE0IiwiQ0gwMTAwMDAwMDAwMzMxIiwiQ0gwMTAwMDAwMDAwMzQxIl0sImNzbSI6MiwicmVnaW9ucyI6WyI4MGJiMDYxMC1mZWE5LTExZWEtYTE5MC0wYjBkNzhkOTI5NjYiLCJmOTE3Y2ZmNi0wMjVhLTQ5MTctODRkNi1mYjY4NjY5N2Q5M2MiLCIyZTE2NzIzNy1jN2JiLTQyM2ItYjYwNi1jMzExMTVhZGIxZGEiXSwidnJpb0RldmljZUlkIjoiNDMxMmNiODItZGFiZi00NzQ0LTllZTEtNGI2NzkwMjQyOGJmIiwibmFtZSI6ImpFU1VTIENPUk9ORUwiLCJpYnNBY2NvdW50U3RhdHVzIjoiQWN0aXZlIiwicmVhbG0iOiIvc3NsYSIsImJ1aWxkIjoiVlJJTy0xLVNTTEEiLCJidXNpbmVzc1VuaXQiOiJTU0xBLU9UVCIsInN1YiI6ImNvcm9uZWxzNTU4QGdtYWlsLmNvbSIsInZyaW9DdXN0b21lcklkIjoiMWJkMzg0MjItNDhiOC01MDhjLThmYjEtOWRkZjRmZmQyNTQ5IiwicmVhZEluRm9yZ2Vyb2NrIjp0cnVlLCJyZWRlbXB0aW9uTGltaXQiOm51bGwsImlhdCI6MTcwMjQyNjI4OSwiZXhwIjoxNzAyNjQyMjg5LCJpc3MiOiJzbS1kZ28udnJpb3NlcnZpY2VzLmNvbSJ9.MdC-5xVAtE4fbgcAaFT2qzVQiQv9obiI-BHGjGe2JZpE6QVu65RvVCBPWfUVWn-mQuP2wBh7FSdDnlU0GxvdWhmYV0tWWMZplQbEn99iYEeixqxhdTtjawoFd4hCsT3UnLwh42jlEc8sUo9MbjxJEmuWwrpwcmV4-CFQqLw6KwbMJqWut6BYAVjiy8lrJ62ayHJmFJNXWLNAG7hLGtoidHi-X7mKWlIG59PRbuotAdIIua6VH9fklBxGYzpDaoeK1Avy5NevkktM9jNvHkZtlecdRA-VgLfvwAt__x7yrwxrau3VR5ZHLPoNtr0WAe_wo7lTNA331BTjqbjfBe-pFQ";

        // Datos de reproducción
        let playbackData = {
            "contentType": 1,
            "device": "Q8EO3jGBj20GzRKkYiLE-pslVT5GGPajIRxjQpWMlDk",
            "duration": 10800,
            "guideId": "41bd1738-5594-4437-aacb-110adda83b9e-CH0100000000341-SH010320170000-202312140900",
            "progress": 8303,
            "sessionId": "session_1hhk0p5m7.3p",
            "streamed": 6,
            "vmsId": "SH0100009CE300000000",
            "vrioAssetId": "41bd1738-5594-4437-aacb-110adda83b9e",
            "channelId": "CH0100000000341",
            "timeZone": "-03:00",
            "clientType": 15
        };

        // Hacer la solicitud a la nueva API
        fetch("https://api.directvgo.com/experiences/v3/playback/streaming", {
            method: "POST",
            headers: {
                "Authorization": "Bearer " + token,
                "Content-Type": "application/json",
                "X-Client-Id": "web",
                "X-Client-Version": "3.18.1"
            },
            body: JSON.stringify(playbackData)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('HTTP error! status: ' + response.status);
            }
            return response.json();
        })
        .then(data => {
            // Manejar la respuesta de la API aquí
            console.log("Respuesta de la API:", data);

            // Asumiendo que la respuesta contiene la URL del manifiesto Dash
            let manifestUrl = data.manifest.dash.primary;

            // Configurar JWPlayer con clearkey y hdntl
            let player = jwplayer("player");
            player.setup({
                playlist: [{
                    sources: [{
                        default: false,
                        type: "dash",
                        file: manifestUrl,
                        drm: {
                            clearkey: {
                                keyId: data.keyId,  // Ajustar según la respuesta real de la API
                                key: data.key      // Ajustar según la respuesta real de la API
                            }
                        },
                        label: "0",
                        onXhrOpen: function (xhr, url) {
                            if (!url.includes("manifest.mpd")) {
                                xhr.setRequestHeader("Hdntl", data.hdntl);
                            }
                        }
                    }]
                }],
                width: "100%",
                height: "100%",
                aspectratio: "16:9",
                autostart: false,
                cast: {},
                sharing: false
            });
        })
        .catch(error => console.error("Error al hacer la solicitud a la API:", error));
    </script>
</body>

</html>
